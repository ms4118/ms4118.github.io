<!DOCTYPE html>
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <link rel="icon" href="images/fevicon.png" type="image/gif" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />

  <title>Op-Mic GOM</title>

  <link rel="stylesheet" href="pyscripts/pyscript.css" />
  <script defer src="pyscripts/pyscript.js"></script>
  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="./js/intro.min.js"></script>

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

  <!-- font awesome style -->
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/introjs.min.css">
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <!-- responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/common.css">
  <py-env>
    - numpy
    - matplotlib
  </py-env>

</head>

<body class="sub_page">
  <div class="hero_area">
    <!-- header section starts -->
    <header class="header_section long_section px-0">
      <nav class="navbar navbar-expand-lg custom_nav-container ">
        <a class="navbar-brand" href="index.html">
          <img class="logo-img" src="./images/logo1.jpg">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class=""> </span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <div class="d-flex mx-auto flex-column flex-lg-row align-items-center">
            <ul class="navbar-nav  ">
              <li class="nav-item ">
                <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="furniture.html">Forecasting Logistics</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="sustainable.html">Sustainable Logistics</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="inventory.html">Inventory Management</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="network.html">Network Optimization</a>
              </li>
              <li class="nav-item active">
                <a class="nav-link" href="01.html">Warehouse Management</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <!-- end header section -->
  </div>

    <!-- Blog section -->
<section class="blog_section layout_padding furniture_section">
    <div class="container">
      <div class="heading_container">
        <h2>
          Global Operation Management - Warehouse Management
        </h2>
      </div>
      <div class="container">
        <div class="row align-items-center">
          <!-- 左侧图片 -->
          <div class="col-md-5">
            <div class="intro-img-box">
              <img src="images/about-w-img.jpg" alt="Introduction Image" class="img-fluid">
            </div>
          </div>
          <!-- 右侧内容 -->
          <div class="col-md-7">
            <section class="slider_section long_section">
              <div id="customCarousel" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <div class="container p-0">
                      <div class="row">
                        <div class="col-12">
                          <div class="img-box">
                            <img src="images/warehouse/1.png" alt="" class="img-fluid">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-item">
                    <div class="container p-0">
                      <div class="row">
                        <div class="col-12">
                          <div class="img-box">
                            <img src="images/warehouse/2.png" alt="" class="img-fluid">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <ol class="carousel-indicators">
                  <li data-target="#customCarousel" data-slide-to="0" class="active"></li>
                  <li data-target="#customCarousel" data-slide-to="1"></li>              
                </ol>
              </div>
            </section>
          </div>
        </div>
    </div>

<div class="row section-container">
        <div class="detail-box">
          <h5 class="title">
            <span>Determine Number of Storage Location (m)</span>
            <span id="step2" class="course-btn" data-index="2">Watch Tutorial</span>
          </h5>
         <form id="inventoryForm"> 
          <table>
          <thead>
          <tr>
          <th>Product Name</th>
          <th>Beginning Inventory</th>
          <th>Minimum Inventory</th>
          <th>Maximum Inventory</th>
          <th>Replenishment Cycle</th>
         </tr>
         </thead>
         <tbody id="productRows">
         <tr>
          <td><input name="productName" required></td>
          <td><input type="text" name="beginInventory" required></td>
          <td><input type="text" name="minInventory" required></td>
          <td><input type="text" name="maxInventory" required></td>
          <td><input type="text" name="cycle" required></td>
          </tr>
         </tbody>
         </table>
         <button type="button" onclick="addRow()">Add Product</button>
         <button type="submit">Calculate</button>
        </form>

  <div id="results" class="output"></div>

  <script>
    function isValidNumber(value) {
  return !isNaN(value) && !isNaN(parseFloat(value)) && isFinite(value);
}
    function addRow() {
      const tbody = document.getElementById('productRows');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input name="productName" required></td>
        <td><input type="text" name="beginInventory" required></td>
        <td><input type="text" name="minInventory" required></td>
        <td><input type="text" name="maxInventory" required></td>
        <td><input type="text" name="cycle" required></td>
      `;
      tbody.appendChild(row);
    }

    document.getElementById('inventoryForm').onsubmit = function(e) {
      e.preventDefault();
      const rows = document.querySelectorAll('#productRows tr');
      const products = [];

      rows.forEach(r => {
  const [nameEl, beginEl, minEl, maxEl, cycleEl] = r.querySelectorAll('input');
  
  // Validate numeric inputs
  if (!isValidNumber(beginEl.value) || !isValidNumber(minEl.value) || 
      !isValidNumber(maxEl.value) || !isValidNumber(cycleEl.value)) {
    alert('Please enter valid numbers for all inventory values');
    return;
  }
  
  const p = {
    name: nameEl.value,
    begin: parseFloat(beginEl.value),
    min: parseFloat(minEl.value),
    max: parseFloat(maxEl.value),
    cycle: parseFloat(cycleEl.value)
  };

        // compute shift
        p.shift = ((p.begin - p.min) / (p.max - p.min)) * p.cycle;
        products.push(p);
      });

      let output = '<h2>Calculation Steps</h2>';
      // Dedicated Storage
      const dedicated = products.reduce((sum,p)=> sum + p.max, 0);
      output += '<strong>Dedicated Storage:</strong><br>';
      products.forEach(p => {
        output += `${p.name}: ${p.max}<br>`;
      });
      output += `Total = ${dedicated}<br><br>`;

      // Random Storage
      const minCycle = Math.min(...products.map(p=>p.cycle));
      const maxTime = minCycle * products.length;
      const allCyclesSame = products.every(p => p.cycle === products[0].cycle);
      const step = allCyclesSame ? 1 : 0.5;

      let bestSum = 0, bestT = 1;

      output += '<strong>Random Storage:</strong><br>';
      for(let t=1; t<=maxTime; t+=step) {
        let sumInv = 0;
        products.forEach(p => {
          let tPrime = ((t - p.shift - 1) % p.cycle + p.cycle) % p.cycle + 1;
          let inv;
          // if tPrime ≤ 1, inventory = beginning (replenished)
          if (tPrime < 1) inv = p.begin;
          else {
            const slope = (p.max - p.min) / p.cycle;
            inv = p.max - slope * (tPrime - 1);
          }
          sumInv += inv;
          output += `${p.name} @t=${t.toFixed(1)} (t'=${tPrime.toFixed(1)}): ${inv.toFixed(1)}<br>`;
        });
        output += `Sum @t=${t.toFixed(1)} = ${sumInv.toFixed(1)}<br><br>`;
        if (sumInv > bestSum) {
          bestSum = sumInv;
          bestT = t;
        }
      }
      output += `<strong>Max Random Storage = ${bestSum.toFixed(1)} @t=${bestT.toFixed(1)}</strong>`;
      document.getElementById('results').innerHTML = output;
    };
  </script>

<!-- Inputs for Layout Parameters -->
<div class="row section-container">
        <div class="detail-box">
          <h5 class="title">
            <span>Warehouse Storage Zone Visualizer (in metre)</span>
          </h5>
    <style>
        body { font-family: Arial, sans-serif; }
        .input-group { margin: 10px 0; }
        label { display: inline-block; width: 180px; }
        canvas { border: 1px solid #333; margin-top: 20px; background: #fff; }
        .scale-control { margin-top: 15px; margin-bottom: 15px; }
        .scale-control label { display: inline-block; width: 200px; margin-right: 10px; }
        .scale-control input[type="range"] { width: 200px; }
        .scale-value { display: inline-block; min-width: 60px; }
    </style>
  <body>
  <form id="warehouseForm">
    <div class="input-group">
      <label for="alpha">Box width (α<sub>x</sub>):</label>
      <input type="number" id="alpha" value="1.05" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="alphay">Box height factor (α<sub>y</sub>):</label>
      <input type="number" id="alphay" value="1.05" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="wx">Sub-aisle width (w<sub>x</sub>):</label>
      <input type="number" id="wx" value="3.5" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="wy">Main aisle width (w<sub>y</sub>):</label>
      <input type="number" id="wy" value="4" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="nz">Height of the box (<i>n<sub>z</sub></i>):</label>
      <input type="number" id="nz" value="4" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="m">Number of storage location (<i>m</i>):</label>
      <input type="number" id="m" value="780" step="any" min="0.01" required>
    </div>
    <div class="input-group">
      <label for="aisleCount">No. of main aisles:</label>
      <select id="aisleCount">
        <option value="1">1</option>
        <option value="3">3</option>
      </select>
    </div>
    <button type="submit">Visualize & Calculate</button>
  </form>
  
  <!-- Scale Factor Control -->
  <div class="scale-control">
    <label for="scaleFactor">Display Scale (pixels per meter):</label>
    <input type="range" id="scaleFactor" min="20" max="200" value="100" step="10">
    <span class="scale-value"><span id="scaleValue">100</span>px/m</span>
  </div>
  
  <div id="optimalResults" class="outputdiv"></div>

  <!-- Zoom Controls -->
  <div class="zoom-controls">
    <button id="zoomInBtn">+</button>
    <button id="zoomOutBtn">-</button>
  </div>

  <canvas id="warehouseCanvas" width="900" height="600"></canvas>

<script>
// SCALE FACTOR - METERS TO PIXELS CONVERSION
const PIXELS_PER_METER = 100; // Base conversion rate

// Zoom variables
let zoomLevel = 1;
let scaleFactor = 100; // Current scale factor
const maxZoom = 3;
const minZoom = 0.5;
const zoomStep = 0.1;

// Store current parameters for redrawing
let currentParams = {
  alpha: 0,
  alphay: 0,
  wx: 0,
  wy: 0,
  nx: 0,
  ny: 0,
  aisleCount: 0,
  nz: 0
};

// Helper function to convert meters to pixels
function metersToPixels(meters) {
  return meters * scaleFactor;
}

// Scale factor slider control
document.getElementById('scaleFactor').addEventListener('input', function(e) {
  scaleFactor = parseFloat(e.target.value);
  document.getElementById('scaleValue').textContent = scaleFactor;
  redrawWarehouse();
});

function calculateOptimals(alpha, alphay, wx, wy, nz, m) {
  // Calculate exact optimal values
  const numeratorY = 2 * m * (alpha + wx / 2);
  const denominatorY = alphay * nz;
  let nOptY = Math.sqrt(numeratorY / denominatorY);

  const numeratorX = m * alphay;
  const denominatorX = 2 * nz * (alpha + wx / 2);
  let nOptX = Math.sqrt(numeratorX / denominatorX);

  // Calculate floor and ceiling for search range
  const nyFloor = Math.max(1, Math.floor(nOptY));
  const nyCeil = Math.max(1, Math.ceil(nOptY));
  const nxFloorEven = Math.max(2, 2 * Math.floor(nOptX / 2));
  const nxCeilEven = Math.max(2, 2 * Math.ceil(nOptX / 2));

  // Search for the best combination that:
  // 1. Satisfies nx * ny * nz >= m
  // 2. Minimizes excess (product - m) to reduce waste
  // 3. nx must be even
  const candidates = [];

  // Search in a reasonable range around optimal values
  for (let ny = Math.max(1, nyFloor - 2); ny <= nyCeil + 10; ny++) {
    for (let nx = nxFloorEven; nx <= nxCeilEven + 10; nx += 2) {  // Step by 2 for even values
      const product = nx * ny * nz;
      if (product >= m) {
        const excess = product - m;
        candidates.push({ nx, ny, product, excess });
      }
    }
  }

  let finalNx, finalNy;

  if (candidates.length === 0) {
    // Fallback: if no combination found, increase values until constraint is met
    finalNy = nyCeil;
    finalNx = nxCeilEven;

    while (finalNx * finalNy * nz < m) {
      if ((finalNx + 2) * finalNy * nz >= m) {
        finalNx += 2;
      } else {
        finalNy += 1;
      }
    }
  } else {
    // Sort by excess (ascending) to minimize waste
    candidates.sort((a, b) => a.excess - b.excess);
    finalNx = candidates[0].nx;
    finalNy = candidates[0].ny;
  }

  return { nOptX: finalNx, nOptY: finalNy };
}

// Zoom button functionality
document.getElementById('zoomInBtn').addEventListener('click', function() {
    if (zoomLevel < maxZoom) {
        zoomLevel += zoomStep;
        zoomLevel = Math.round(zoomLevel * 100) / 100; // Fix floating point issues
        redrawWarehouse();
    }
});

document.getElementById('zoomOutBtn').addEventListener('click', function() {
    if (zoomLevel > minZoom) {
        zoomLevel -= zoomStep;
        zoomLevel = Math.round(zoomLevel * 100) / 100; // Fix floating point issues
        redrawWarehouse();
    }
});

function redrawWarehouse() {
    drawWarehouse(currentParams.alpha, currentParams.alphay, currentParams.wx, currentParams.wy, currentParams.nz, currentParams.nx, currentParams.ny, currentParams.aisleCount);
}

document.getElementById('warehouseForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const alpha = parseFloat(document.getElementById('alpha').value);
  const alphay = parseFloat(document.getElementById('alphay').value);
  const wx = parseFloat(document.getElementById('wx').value);
  const wy = parseFloat(document.getElementById('wy').value);
  const nz = parseFloat(document.getElementById('nz').value);
  const m = parseFloat(document.getElementById('m').value);
  const aisleCount = parseInt(document.getElementById('aisleCount').value);

  const { nOptX, nOptY } = calculateOptimals(alpha, alphay, wx, wy, nz, m);

  // Store parameters for zoom redrawing
  currentParams = { alpha, alphay, wx, wy, nz, nx: nOptX, ny: nOptY, aisleCount };
  zoomLevel = 1; // Reset zoom level

  document.getElementById('optimalResults').innerHTML =
    `<b>Optimal Vertical (n'<sub>y</sub>):</b> ${nOptY}<br>
     <b>Optimal Horizontal (n'<sub>x</sub>):</b> ${nOptX}`;

  drawWarehouse(alpha, alphay, wx, wy, nz, nOptX, nOptY, aisleCount);
});

function drawWarehouse(alpha, alphay, wx, wy, nz, nx, ny, aisleCount) {
  const canvas = document.getElementById('warehouseCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Convert all measurements from meters to pixels
  const alphaPixels = metersToPixels(alpha);
  const alphayPixels = metersToPixels(alphay);
  const wxPixels = metersToPixels(wx);
  const wyPixels = metersToPixels(wy);

  // Calculate warehouse dimensions
  const groups = nx / 2;
  const totalBoxWidth = groups * 2 * alphaPixels;
  const totalSubWidth = groups * wxPixels;
  const W = totalBoxWidth + totalSubWidth;

  const upperRows = Math.floor(ny / 2);
  const lowerRows = ny - upperRows;
  const mainAisles = aisleCount;

  const H = ny * alphayPixels + mainAisles * wyPixels;

  // Centering offsets
  const offsetX = (canvas.width - W) / 2;
  const offsetY = (canvas.height - H) / 2;

  // Apply zoom transformation
  ctx.save();
  ctx.translate(canvas.width / 2, canvas.height / 2);
  ctx.scale(zoomLevel, zoomLevel);
  ctx.translate(-canvas.width / 2, -canvas.height / 2);

  // Draw boundary
  ctx.save();
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2;
  ctx.strokeRect(offsetX, offsetY, W, H);
  ctx.restore();

  // Draw main aisles (same pattern as your logic)
  const mainLabels = [];
  if (aisleCount === 1) {
    const y = offsetY + upperRows * alphayPixels;
    ctx.fillStyle = '#e0e0e0';
    ctx.fillRect(offsetX, y, W, wyPixels);
    mainLabels.push({ text: 'main aisle', x: offsetX + W / 2, y: y + wyPixels / 2 });
  } else {
    // 3-aisle mode: top, middle, bottom
    // Top aisle
    ctx.fillStyle = '#e0e0e0';
    ctx.fillRect(offsetX, offsetY, W, wyPixels);
    mainLabels.push({ text: 'main aisle 1', x: offsetX + W / 2, y: offsetY + wyPixels / 2 });
    // Middle aisle
    const y2 = offsetY + wyPixels + upperRows * alphayPixels;
    ctx.fillRect(offsetX, y2, W, wyPixels);
    mainLabels.push({ text: 'main aisle 2', x: offsetX + W / 2, y: y2 + wyPixels / 2 });
    // Bottom aisle
    const y3 = offsetY + wyPixels + upperRows * alphayPixels + wyPixels + lowerRows * alphayPixels;
    ctx.fillRect(offsetX, y3, W, wyPixels);
    mainLabels.push({ text: 'main aisle 3', x: offsetX + W / 2, y: y3 + wyPixels / 2 });
  }

  // Draw each group (columns, sub-aisle, columns)
  for (let g = 0; g < groups; g++) {
    const groupX = offsetX + g * (2 * alphaPixels + wxPixels);
    // Column A
    drawColumn(ctx, groupX, alphaPixels, alphayPixels, nx, ny, wyPixels, aisleCount, offsetY, upperRows, lowerRows);
    // Sub-aisle isn't drawn (empty gap)
    // Column B
    drawColumn(ctx, groupX + alphaPixels + wxPixels, alphaPixels, alphayPixels, nx, ny, wyPixels, aisleCount, offsetY, upperRows, lowerRows);
  }

  // Draw main aisle labels
  ctx.save();
  ctx.font = '18px Arial';
  ctx.fillStyle = '#333';
  ctx.textAlign = 'center';
  for (let m of mainLabels) ctx.fillText(m.text, m.x, m.y + 6);
  ctx.restore();

  ctx.restore();
}

function drawColumn(ctx, x, alphaPixels, alphayPixels, nx, ny, wyPixels, aisleCount, offsetY, upperRows, lowerRows) {
  if (aisleCount === 1) {
    // upper
    for (let r = 0; r < upperRows; r++)
      drawBox(ctx, x, offsetY + r * alphayPixels, alphaPixels, alphayPixels);
    // lower
    for (let r = 0; r < lowerRows; r++)
      drawBox(ctx, x, offsetY + upperRows * alphayPixels + wyPixels + r * alphayPixels, alphaPixels, alphayPixels);
  } else {
    // 3 main aisles: top/bottom/middle
    // after top aisle
    for (let r = 0; r < upperRows; r++)
      drawBox(ctx, x, offsetY + wyPixels + r * alphayPixels, alphaPixels, alphayPixels);
    // after middle aisle
    for (let r = 0; r < lowerRows; r++)
      drawBox(ctx, x, offsetY + wyPixels + upperRows * alphayPixels + wyPixels + r * alphayPixels, alphaPixels, alphayPixels);
  }
}

function drawBox(ctx, x, y, alphaPixels, alphayPixels) {
  ctx.save();
  ctx.fillStyle = '#fff';
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 1.5;
  ctx.strokeRect(x, y, alphaPixels, alphayPixels);
  ctx.restore();
}

// Initial draw
window.onload = function() {
  // Use default sample values from DOM
  const alpha = parseFloat(document.getElementById('alpha').value);
  const alphay = parseFloat(document.getElementById('alphay').value);
  const wx = parseFloat(document.getElementById('wx').value);
  const wy = parseFloat(document.getElementById('wy').value);
  const nz = parseFloat(document.getElementById('nz').value);
  const m = parseFloat(document.getElementById('m').value);
  const aisleCount = parseInt(document.getElementById('aisleCount').value);

  const { nOptX, nOptY } = calculateOptimals(alpha, alphay, wx, wy, nz, m);

  // Store parameters for zoom redrawing
  currentParams = { alpha, alphay, wx, wy, nz, nx: nOptX, ny: nOptY, aisleCount };

  document.getElementById('optimalResults').innerHTML =
    `<b>Optimal Vertical (n'<sub>y</sub>):</b> ${nOptY}<br>
     <b>Optimal Horizontal (n'<sub>x</sub>):</b> ${nOptX}`;
  drawWarehouse(alpha, alphay, wx, wy, nz, nOptX, nOptY, aisleCount);
};
</script>
</body>

  <!-- footer section -->
  <footer class="footer_section">
    <div class="container">
      <p>
        &copy; <span id="displayYear"></span> Op-Mic GOM 2025
      </p>
    </div>
  </footer>
  <!-- footer section -->

  <!-- bootstrap js -->
  <script src="js/bootstrap.js"></script>

</body>

<script>
  $(document).ready(function () {
    var steps = [
      {
        element: '#step1',
        intro: '<div class="tip-box"><img src="./images/intro/step31.jpg" style="width:100%;height:auto;"></div>',
        tooltipClass: 'step-tooltip',
        // position: 'bottom-right-aligned'
      },
    ]

    $(".course-btn").click(function () {
      var offset = $(this).offset();
      console.log("offset:", offset, $(this).index)

      var index = Number($(this).data("index"))

      $('body').find('.step-helperLayer').remove();

      // decoration
      var sw = $(window).width();
      var w = $(this).width();
      var h = $(this).height();
      $('body').append(`<div class="step-helperLayer" style="width:${w}px;height:${h}px;top:${offset.top}px;left:${offset.left}px;box-shadow:rgba(33, 33, 33, 0.8) 0px 0px 1px 2px, rgba(33, 33, 33, 0.5) 0px 0px 0px 5000px"></div>`);
      var stepfixedDom = $(`<div class='step-fixed-container' style="top:${offset.top + h}px;right:${sw - offset.left - w / 2}px"></div>`)

      var stepImg = $(`${steps[index - 1].intro}`);
      var sanjiaox = $(`<div class="triangle-up"></div>`)
      var closeDom = $(`<div class="close-btn"><img src="./images/close.png" /></div>`)

      // stepfixedDom
      stepfixedDom.append(stepImg);
      stepfixedDom.append(sanjiaox);
      stepfixedDom.append(closeDom);
      $('body').append(stepfixedDom)
    })

    $('body').on('click', '.step-fixed-container .close-btn', function () {
      $('body').find('.step-helperLayer').remove();
      $('body').find('.step-fixed-container').remove();
    });
    
  });
  
  
</script>

</html>