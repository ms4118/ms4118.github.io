<!DOCTYPE html>
<html>

<head>
    <!-- Basic -->
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <!-- Site Metas -->
    <link rel="icon" href="images/fevicon.png" type="image/gif"/>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>

    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/>
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <script src="https://unpkg.com/gridjs/dist/gridjs.production.min.js"></script>

    <title>Michael GOM</title>


    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>

    <!-- fonts style -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,600,700&display=swap" rel="stylesheet"/>

    <!-- font awesome style -->
    <link href="css/font-awesome.min.css" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet"/>
    <!-- responsive style -->
    <link href="css/responsive.css" rel="stylesheet"/>
    <!-- for splashscreen -->
        
    <py-env>
      - scipy
      - plotly
      - matplotlib
    </py-env>

</head>

<body class="sub_page">
<div class="hero_area">
    <!-- header section strats -->
    <header class="header_section long_section px-0">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
            <a class="navbar-brand" href="index.html">
          <span>
            Michael GOM
          </span>
            </a>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class=""> </span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <div class="d-flex mx-auto flex-column flex-lg-row align-items-center">
                    <ul class="navbar-nav  ">
                        <li class="nav-item ">
                            <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html"> About</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="furniture.html">Forecasting Logistics</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="blog.html">Inventory Management</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact Us</a>
                        </li>
                    </ul>
                </div>
                <div class="quote_btn-container">
                    <a href="">
              <span>
                Project
              </span>
                        <i class="fa fa-user" aria-hidden="true"></i>
                    </a>
                    <form class="form-inline">
                        <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit">
                            <i class="fa fa-search" aria-hidden="true"></i>
                        </button>
                    </form>
                </div>
            </div>
        </nav>
    </header>
    <!-- end header section -->
</div>

<section class="furniture_section layout_padding">
    <div class="container">
        <div class="heading_container">
            <h2>
                Global Operation Management - Forecasting Logistics
            </h2>
            <p>
                This page aims to help you solve problems from Global operation management sector, specifically about
                Forecasting logistics.
            </p>
        </div>

        <div class="row">
          <div class="col-md-4 col-lg-4 mx-auto">
            <div class="box">
              <div class="detail-box">
                <h5>
                  Transport problem.
                </h5>
                <div class="">
                    <input type="number" onkeyup="if(this.value<0)this.value=1" onblur="if(this.value<0)this.value=1" id="C" placeholder="num_factories " style="width: 250px;">
                    <input type="number" onkeyup="if(this.value<0)this.value=1" onblur="if(this.value<0)this.value=1" id="D" placeholder="num_stores" style="width: 250px;">
                    <input type="text" onkeyup="if(this.value<0)this.value=1" onblur="if(this.value<0)this.value=1" id="E" placeholder="cost_matrix, like:4, 7, 7, 1..." style="width: 500px;">
                    <input type="text" onkeyup="if(this.value<0)this.value=1" onblur="if(this.value<0)this.value=1" id="F" placeholder="supplys, like:100, 200, 150..." style="width: 500px;">
                    <input type="text" onkeyup="if(this.value<0)this.value=1" onblur="if(this.value<0)this.value=1" id="G" placeholder="demands, like:80, 90, 120..." style="width: 500px;">
                    <button id="button_instant">Solve Problem</button>
                  <py-script>
                    import numpy as np
                    from scipy.optimize import linprog
                    from js import window
                    from pyodide import create_proxy
                    
                    
                    def format_data(matrix, supply, demand, bottom_left_data=''):
                      h = ['']
                      for i in range(len(demand)):
                        h.append(f'S{i+1}')
                      h.append('supply')
                      index = []
                      for j in range(len(supply)):
                        index.append(f'F{j+1}')
                      index.append('demand')
                    
                      result = np.column_stack((matrix, supply))
                      demand = np.append(demand, bottom_left_data)
                      result = np.vstack((result, demand))
                      result = np.column_stack((np.array(index), result))
                    
                      return h, result.tolist()
                    
                    
                    def get_cost_and_total_result(cost_matrix, supply, demand):
                      # 构建决策变量的系数矩阵
                      # 每个工厂到每个商店的运输量可以看作是一个决策变量
                      # 因此，我们有 num_factories * num_stores 个决策变量
                      # 系数矩阵 A 和 b 用于表示供应和需求约束
                      num_factories = len(supply)
                      num_stores = len(demand)
                    
                      # 供应约束的系数矩阵 A_supply 和向量 b_supply
                      A_supply = []
                      for i in range(num_factories):
                        row = [0] * (num_factories * num_stores)
                        for j in range(num_stores):
                          row[i * num_stores + j] = 1
                        A_supply.append(row)
                      A_supply = np.array(A_supply)
                      b_supply = supply
                    
                      # 需求约束的系数矩阵 A_demand 和向量 b_demand
                      A_demand = []
                      for j in range(num_stores):
                        row = [0] * (num_factories * num_stores)
                        for i in range(num_factories):
                          row[i * num_stores + j] = 1
                        A_demand.append(row)
                      A_demand = np.array(A_demand)
                      b_demand = demand
                    
                      # 合并供应和需求约束
                      A = np.vstack((A_supply, -A_demand))  # 注意：需求约束是 >=，所以这里取负号
                      b = np.hstack((b_supply, -b_demand))
                    
                      # 目标函数的系数向量 c
                      c = cost_matrix.flatten()  # 将成本矩阵展平为一维数组
                    
                      # 求解线性规划问题
                      result = linprog(c, A_ub=A, b_ub=b, method='highs')
                    
                      # 将结果重新整形为 num_factories x num_stores 的矩阵
                      x = result.x.reshape((num_factories, num_stores))
                    
                      # 输出结果
                      print("Optimal solution:")
                      print(x)
                      print("Optimal value (total cost):", result.fun)
                    
                      return x, result.fun


                    def on_instant(event):
                          n = int(Element("C").element.value)
                          m = int(Element("D").element.value)
                          cost_matrix = [float(i) for i in Element("E").element.value.split(',')]
                          supply = [float(i) for i in Element("F").element.value.split(',')]
                          demand = [float(i) for i in Element("G").element.value.split(',')]
                          if len(cost_matrix) == n*m and len(supply)==n and len(demand)==m:
                            cost_matrix = np.reshape(cost_matrix, (n, m))
                            supply = np.array(supply)
                            demand = np.array(demand)
                            h, d = format_data(cost_matrix, supply, demand, f'{np.sum(demand)}/{np.sum(supply)}')
                            print(h)
                            print(d)
                            window.setTable(str(h), str(d), "out1")
                            x, total_cost = get_cost_and_total_result(cost_matrix, supply, demand)
                            h, d = format_data(x, supply, demand, f'total_cost:{total_cost}')
                            window.setTable(str(h), str(d), "out2")

                            Element("out_instant").element.innerHTML = "Ok"
                          else:
                            Element("out_instant").element.innerHTML = "Please input real data length."
      
      
                    Element("button_instant").element.onclick = on_instant
                  </py-script>
                  <div id="out_instant"></div>
              </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="box">
              <div class="detail-box" id="out1">
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
            <div class="box">
              <div class="detail-box" id="out2">
              </div>
            </div>
          </div>
        </div>
    </div>
</section>


<!-- footer section -->
<footer class="footer_section">
    <div class="container">
        <p>
            &copy; <span id="displayYear"></span> Michael
            <a href="https://html.design/">2024</a>
        </p>
    </div>
</footer>
<!-- footer section -->

<script>
  function str2Aarry(str) {
    str = str.slice(1, -1); // 使用 slice 方法去除第一个和最后一个字符（即方括号）
 
    // 步骤2: 使用 split 方法按逗号分割字符串
    // 注意：这里我们得到一个包含字符串元素的数组，可能还需要进一步处理
    let arr = str.split(',').map(item => {
        // 去除元素两侧的空格（如果有的话）
        item = item.trim();
        item = item.replace(/^'|'$/g, '');
        
        return item;
    });

    return arr
  }
  function str2Aarry2D(str) {
    // 第一步：去除最外层的方括号
    str = str.slice(1, -1);
    
    // 第二步：按外部逗号分割字符串以获取内部数组的字符串表示
    let innerArrayStrs = str.split('], [');
    
    // 第三步：将每个内部数组的字符串表示转换为真正的数组
    let twoDArray = innerArrayStrs.map(str2Aarry)

    return twoDArray
  }
  function setTable(headers, data, renderId) {
    console.log(headers)
    console.log(data)
    const grid = new gridjs.Grid({
        columns: str2Aarry(headers),
        data: str2Aarry2D(data)
      })
    // 获取容器元素
    const container = document.getElementById(renderId);
    // 清空容器元素（虽然在这个例子中它应该是空的，但这是一个好习惯）
    container.innerHTML = '';
    // 渲染 Grid.js 表格
    grid.render(container);
  }
</script>
<!-- jQery -->
<script src="js/jquery-3.4.1.min.js"></script>
<!-- bootstrap js -->
<script src="js/bootstrap.js"></script>
<!-- custom js -->
<script src="js/custom.js"></script>
<!-- Google Map -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap"></script>
<!-- End Google Map -->

</body>

</html>
